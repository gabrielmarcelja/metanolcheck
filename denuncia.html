<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Denuncie estabelecimentos suspeitos de vender bebidas adulteradas">
  <title>Denunciar Estabelecimento - MetanolCheck</title>

  <!-- CSS -->
  <link rel="stylesheet" href="css/styles.css">

  <!-- Font Awesome CDN -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <!-- Favicon -->
  <link rel="icon" type="image/png" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üîç</text></svg>">
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="container">
      <div class="header-content">
        <a href="index.html" class="logo">
          <i class="fas fa-shield-alt"></i>
          MetanolCheck
        </a>
        <button class="menu-toggle" aria-label="Menu">
          <i class="fas fa-bars"></i>
        </button>
        <nav class="nav">
          <a href="index.html" class="nav-link">In√≠cio</a>
          <a href="educacao.html" class="nav-link">Educa√ß√£o</a>
          <a href="denuncia.html" class="nav-link">Denunciar</a>
          <a href="sobre.html" class="nav-link">Sobre</a>
        </nav>
      </div>
    </div>
  </header>

  <!-- Hero Section -->
  <section class="hero" style="padding: 48px 0;">
    <div class="container">
      <h1><i class="fas fa-flag"></i> Denunciar Estabelecimento</h1>
      <p>Ajude a proteger outras pessoas reportando estabelecimentos suspeitos</p>
    </div>
  </section>

  <!-- Main Content -->
  <main class="container container-narrow" style="margin-top: 32px; margin-bottom: 32px;">

    <!-- Alertas Importantes -->
    <div class="alert alert-danger">
      <h4><i class="fas fa-exclamation-triangle"></i> Importante: Em caso de emerg√™ncia</h4>
      <p><strong>Se voc√™ ou algu√©m apresentar sintomas de intoxica√ß√£o, ligue imediatamente:</strong></p>
      <div class="flex gap-2 flex-wrap mt-2">
        <a href="tel:192" class="btn btn-danger">
          <i class="fas fa-phone-alt"></i> SAMU 192
        </a>
        <a href="tel:08007226001" class="btn btn-danger">
          <i class="fas fa-phone-alt"></i> Disque-Intoxica√ß√£o 0800 722 6001
        </a>
      </div>
    </div>

    <div class="alert alert-warning">
      <h4><i class="fas fa-info-circle"></i> Orienta√ß√µes para Den√∫ncias</h4>
      <ul style="margin-bottom: 0;">
        <li><strong>N√ÉO</strong> fa√ßa testes caseiros com bebidas suspeitas</li>
        <li>Denuncie tamb√©m aos √≥rg√£os oficiais: Vigil√¢ncia Sanit√°ria, Pol√≠cia Civil, Procon</li>
        <li>Se poss√≠vel, guarde a embalagem da bebida como prova</li>
        <li>Den√∫ncias an√¥nimas s√£o aceitas e sua identidade ser√° protegida</li>
        <li>Fa√ßa den√∫ncias baseadas em fatos, n√£o em suposi√ß√µes</li>
      </ul>
    </div>

    <!-- Formul√°rio de Den√∫ncia -->
    <div class="card">
      <div class="card-header">
        <h3><i class="fas fa-edit"></i> Formul√°rio de Den√∫ncia</h3>
      </div>
      <div class="card-body">
        <form id="formDenuncia">

          <div class="form-group">
            <label class="form-label" for="cnpjDenuncia">
              CNPJ do Estabelecimento
              <span style="color: var(--cinza-600); font-weight: normal;">(opcional se n√£o souber)</span>
            </label>
            <input
              type="text"
              id="cnpjDenuncia"
              class="form-input"
              placeholder="XX.XXX.XXX/XXXX-XX"
              maxlength="18"
              data-validacao="cnpj"
              data-nome="CNPJ"
            >
            <p class="form-help">Se voc√™ tiver o CNPJ do estabelecimento, isso ajudar√° no rastreamento</p>
          </div>

          <div class="form-group">
            <label class="form-label" for="nomeEstabelecimento">
              Nome do Estabelecimento *
            </label>
            <input
              type="text"
              id="nomeEstabelecimento"
              class="form-input"
              placeholder="Digite o nome do bar, restaurante ou loja"
              required
              data-nome="Nome do estabelecimento"
            >
          </div>

          <div class="form-group">
            <label class="form-label" for="enderecoEstabelecimento">
              Endere√ßo do Estabelecimento *
            </label>
            <input
              type="text"
              id="enderecoEstabelecimento"
              class="form-input"
              placeholder="Rua, n√∫mero, bairro, cidade - Estado"
              required
              data-nome="Endere√ßo"
            >
            <p class="form-help">Seja o mais espec√≠fico poss√≠vel</p>
          </div>

          <div class="form-group">
            <label class="form-label" for="dataDenuncia">
              Data do Ocorrido *
            </label>
            <input
              type="date"
              id="dataDenuncia"
              class="form-input"
              required
              data-validacao="data"
              data-nome="Data"
            >
          </div>

          <div class="form-group">
            <label class="form-label" for="tipoDenuncia">
              Tipo de Problema *
            </label>
            <select id="tipoDenuncia" class="form-select" required>
              <option value="">Selecione...</option>
              <option value="bebida-suspeita">Bebida com apar√™ncia/cheiro suspeito</option>
              <option value="intoxicacao">Sintomas de intoxica√ß√£o ap√≥s consumo</option>
              <option value="preco-baixo">Pre√ßos muito abaixo do mercado</option>
              <option value="embalagem-suspeita">Embalagem adulterada ou sem lacre</option>
              <option value="sem-nota-fiscal">Estabelecimento n√£o emite nota fiscal</option>
              <option value="outros">Outros</option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label" for="descricaoDenuncia">
              Descri√ß√£o Detalhada *
            </label>
            <textarea
              id="descricaoDenuncia"
              class="form-textarea"
              placeholder="Descreva o que aconteceu com o m√°ximo de detalhes poss√≠vel. Inclua informa√ß√µes sobre a bebida, sintomas, testemunhas, etc."
              required
              data-nome="Descri√ß√£o"
              style="min-height: 150px;"
            ></textarea>
            <p class="form-help">Quanto mais detalhes, mais √∫til ser√° a den√∫ncia</p>
          </div>

          <div class="form-group">
            <label class="form-label">
              Voc√™ tem provas? (Fotos, notas, testemunhas)
            </label>
            <div class="form-checkbox">
              <input type="checkbox" id="temProvas" name="temProvas">
              <label for="temProvas">Sim, tenho provas que posso apresentar √†s autoridades</label>
            </div>
            <p class="form-help">Nota: Esta plataforma n√£o armazena arquivos. Guarde as provas para apresentar aos √≥rg√£os oficiais.</p>
          </div>

          <div class="form-group">
            <label class="form-label" for="contatoDenunciante">
              Seu Contato (Email ou Telefone)
              <span style="color: var(--cinza-600); font-weight: normal;">(opcional)</span>
            </label>
            <input
              type="text"
              id="contatoDenunciante"
              class="form-input"
              placeholder="seu@email.com ou (XX) XXXXX-XXXX"
            >
            <p class="form-help">Opcional, mas pode ajudar na investiga√ß√£o</p>
          </div>

          <div class="form-group">
            <div class="form-checkbox">
              <input type="checkbox" id="denunciaAnonima" name="denunciaAnonima">
              <label for="denunciaAnonima">Den√∫ncia an√¥nima</label>
            </div>
            <p class="form-help">Suas informa√ß√µes de contato n√£o ser√£o exibidas publicamente</p>
          </div>

          <div class="form-group">
            <div class="form-checkbox">
              <input type="checkbox" id="concordoTermos" name="concordoTermos" required>
              <label for="concordoTermos">
                Declaro que as informa√ß√µes fornecidas s√£o verdadeiras e estou ciente de que den√∫ncias falsas podem ter consequ√™ncias legais *
              </label>
            </div>
          </div>

          <div id="formErrors" class="alert alert-danger hidden"></div>

          <div class="flex gap-2 flex-wrap">
            <button type="submit" class="btn btn-danger btn-lg">
              <i class="fas fa-paper-plane"></i> Enviar Den√∫ncia
            </button>
            <a href="index.html" class="btn btn-secondary btn-lg">
              <i class="fas fa-times"></i> Cancelar
            </a>
          </div>
        </form>
      </div>
    </div>

    <!-- Informa√ß√µes Adicionais -->
    <div class="card" style="background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);">
      <div class="card-header">
        <h3><i class="fas fa-lightbulb"></i> O que acontece ap√≥s a den√∫ncia?</h3>
      </div>
      <div class="card-body">
        <ol style="padding-left: 20px;">
          <li><strong>Registro Local:</strong> Sua den√∫ncia ficar√° registrada na plataforma e ser√° vis√≠vel na p√°gina do estabelecimento</li>
          <li><strong>Alerta a Outros Usu√°rios:</strong> Outros usu√°rios ver√£o que h√° den√∫ncias contra o estabelecimento</li>
          <li><strong>Score de Confian√ßa:</strong> O score de confian√ßa do estabelecimento ser√° reduzido</li>
          <li><strong>A√ß√£o Recomendada:</strong> Recomendamos tamb√©m fazer den√∫ncia oficial aos √≥rg√£os competentes</li>
        </ol>

        <div class="mt-3">
          <h5>Onde denunciar oficialmente:</h5>
          <ul class="signals-list">
            <li>
              <i class="fas fa-check icon-check"></i>
              <strong>Vigil√¢ncia Sanit√°ria</strong> - √ìrg√£o respons√°vel pela fiscaliza√ß√£o de estabelecimentos
            </li>
            <li>
              <i class="fas fa-check icon-check"></i>
              <strong>Pol√≠cia Civil</strong> - Para crimes de adultera√ß√£o de produtos
            </li>
            <li>
              <i class="fas fa-check icon-check"></i>
              <strong>Procon</strong> - Para quest√µes de direito do consumidor
            </li>
            <li>
              <i class="fas fa-check icon-check"></i>
              <strong>Minist√©rio P√∫blico</strong> - Para crimes contra a sa√∫de p√∫blica
            </li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Sintomas de Intoxica√ß√£o -->
    <div class="card" style="background: linear-gradient(135deg, #fee2e2 0%, #fecaca 100%); border-left: 4px solid #ef4444;">
      <div class="card-header">
        <h3><i class="fas fa-heartbeat"></i> Sintomas de Intoxica√ß√£o por Metanol</h3>
      </div>
      <div class="card-body">
        <p><strong>Procure atendimento m√©dico IMEDIATAMENTE se apresentar:</strong></p>
        <ul class="signals-list">
          <li><span class="icon-alert">‚ö†Ô∏è</span> Vis√£o turva ou emba√ßada (pode levar √† cegueira)</li>
          <li><span class="icon-alert">‚ö†Ô∏è</span> N√°usea e v√¥mitos intensos</li>
          <li><span class="icon-alert">‚ö†Ô∏è</span> Dor de cabe√ßa severa</li>
          <li><span class="icon-alert">‚ö†Ô∏è</span> Dor abdominal forte</li>
          <li><span class="icon-alert">‚ö†Ô∏è</span> Dificuldade para respirar</li>
          <li><span class="icon-alert">‚ö†Ô∏è</span> Confus√£o mental ou perda de consci√™ncia</li>
          <li><span class="icon-alert">‚ö†Ô∏è</span> Convuls√µes</li>
        </ul>

        <div class="flex gap-2 flex-wrap mt-3">
          <a href="tel:192" class="btn btn-danger">
            <i class="fas fa-phone-alt"></i> SAMU 192
          </a>
          <a href="tel:08007226001" class="btn btn-danger">
            <i class="fas fa-phone-alt"></i> Disque-Intoxica√ß√£o 0800 722 6001
          </a>
          <a href="educacao.html" class="btn btn-primary">
            <i class="fas fa-graduation-cap"></i> Saiba Mais
          </a>
        </div>
      </div>
    </div>

  </main>

  <!-- Footer -->
  <footer class="footer">
    <div class="container">
      <div class="footer-content">
        <div class="footer-section">
          <h4>MetanolCheck</h4>
          <p>Plataforma de verifica√ß√£o de seguran√ßa de estabelecimentos para preven√ß√£o de intoxica√ß√£o por metanol.</p>
        </div>

        <div class="footer-section">
          <h4>Links √öteis</h4>
          <ul>
            <li><a href="index.html">In√≠cio</a></li>
            <li><a href="educacao.html">Educa√ß√£o</a></li>
            <li><a href="denuncia.html">Denunciar</a></li>
            <li><a href="sobre.html">Sobre</a></li>
          </ul>
        </div>

        <div class="footer-section">
          <h4>Contato</h4>
          <ul>
            <li><i class="fas fa-envelope"></i> contato@metanolcheck.com.br</li>
            <li><i class="fas fa-shield-alt"></i> Vigil√¢ncia Sanit√°ria</li>
            <li><i class="fas fa-balance-scale"></i> Procon</li>
          </ul>
        </div>
      </div>

      <div class="footer-disclaimer">
        <p><strong>Avisos Importantes:</strong></p>
        <p>‚Ä¢ Esta aplica√ß√£o n√£o substitui fiscaliza√ß√£o oficial de √≥rg√£os competentes.</p>
        <p>‚Ä¢ Em caso de suspeita de bebida adulterada, contate imediatamente as autoridades competentes.</p>
        <p>‚Ä¢ As avalia√ß√µes s√£o baseadas em dados p√∫blicos e contribui√ß√µes de usu√°rios.</p>
        <p>‚Ä¢ N√£o nos responsabilizamos por decis√µes baseadas nestas informa√ß√µes.</p>
        <p style="margin-top: 16px; text-align: center;">
          ¬© 2025 MetanolCheck. Desenvolvido para seguran√ßa p√∫blica.
        </p>
      </div>
    </div>
  </footer>

  <!-- Scripts -->
  <script src="js/validacao.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/api.js"></script>
  <script src="js/main.js"></script>

  <script>
    // Scripts espec√≠ficos da p√°gina de den√∫ncia
    document.addEventListener('DOMContentLoaded', function() {
      // Verifica se h√° CNPJ na URL
      const cnpjUrl = App.obterParametroUrl('cnpj');
      if (cnpjUrl) {
        document.getElementById('cnpjDenuncia').value = Validacao.formatarCNPJ(cnpjUrl);

        // Tenta preencher nome do estabelecimento do cache
        const cache = Storage.recuperarCacheCNPJ(cnpjUrl);
        if (cache) {
          const nomeFantasia = cache.alias || cache.company?.name || '';
          if (nomeFantasia) {
            document.getElementById('nomeEstabelecimento').value = nomeFantasia;
          }

          const endereco = cache.address;
          if (endereco) {
            const enderecoCompleto = API.montarEnderecoCompleto(endereco);
            document.getElementById('enderecoEstabelecimento').value = enderecoCompleto;
          }
        }
      }

      // M√°scara de CNPJ
      const inputCNPJ = document.getElementById('cnpjDenuncia');
      Validacao.aplicarMascaraCNPJ(inputCNPJ);

      // Define data m√°xima como hoje
      const inputData = document.getElementById('dataDenuncia');
      const hoje = new Date().toISOString().split('T')[0];
      inputData.max = hoje;
      inputData.value = hoje;

      // Submit do formul√°rio
      const form = document.getElementById('formDenuncia');
      form.addEventListener('submit', function(e) {
        e.preventDefault();

        // Valida√ß√£o
        Validacao.limparErrosFormulario(form);
        const validacao = validarFormularioDenuncia();

        if (!validacao.valido) {
          const errorDiv = document.getElementById('formErrors');
          errorDiv.innerHTML = '<strong>Erros encontrados:</strong><ul>' +
            validacao.erros.map(erro => `<li>${erro}</li>`).join('') +
            '</ul>';
          errorDiv.classList.remove('hidden');
          App.scrollPara('#formErrors');
          return;
        }

        // Coleta dados
        const cnpj = Validacao.limparCNPJ(document.getElementById('cnpjDenuncia').value);
        const denuncia = {
          cnpj: cnpj,
          nomeEstabelecimento: document.getElementById('nomeEstabelecimento').value.trim(),
          endereco: document.getElementById('enderecoEstabelecimento').value.trim(),
          dataOcorrido: document.getElementById('dataDenuncia').value,
          tipo: document.getElementById('tipoDenuncia').value,
          descricao: document.getElementById('descricaoDenuncia').value.trim(),
          temProvas: document.getElementById('temProvas').checked,
          contato: document.getElementById('contatoDenunciante').value.trim(),
          anonimo: document.getElementById('denunciaAnonima').checked
        };

        // Salva den√∫ncia
        if (cnpj) {
          Storage.salvarDenuncia(cnpj, denuncia);
        }

        // Mostra sucesso
        App.mostrarModal(
          'Den√∫ncia Registrada',
          `
            <div class="alert alert-success">
              <h4><i class="fas fa-check-circle"></i> Den√∫ncia registrada com sucesso!</h4>
              <p>Sua den√∫ncia foi registrada em nossa plataforma. Recomendamos que voc√™ tamb√©m fa√ßa uma den√∫ncia oficial aos √≥rg√£os competentes:</p>
              <ul>
                <li>Vigil√¢ncia Sanit√°ria</li>
                <li>Pol√≠cia Civil</li>
                <li>Procon</li>
              </ul>
              ${cnpj ? `<p class="mt-2"><strong>A den√∫ncia aparecer√° na p√°gina do estabelecimento.</strong></p>` : ''}
            </div>
          `,
          [
            {
              texto: 'Ver Resultado',
              classe: 'btn-primary',
              callback: () => {
                if (cnpj) {
                  window.location.href = `resultado.html?cnpj=${cnpj}`;
                } else {
                  window.location.href = 'index.html';
                }
              }
            },
            {
              texto: 'Nova Den√∫ncia',
              classe: 'btn-secondary',
              callback: () => {
                form.reset();
                inputData.value = hoje;
                window.scrollTo(0, 0);
              }
            }
          ]
        );
      });

      // Quando marca den√∫ncia an√¥nima, limpa contato
      document.getElementById('denunciaAnonima').addEventListener('change', function() {
        if (this.checked) {
          document.getElementById('contatoDenunciante').value = '';
          document.getElementById('contatoDenunciante').disabled = true;
        } else {
          document.getElementById('contatoDenunciante').disabled = false;
        }
      });
    });

    function validarFormularioDenuncia() {
      const erros = [];

      // CNPJ (opcional, mas se preenchido deve ser v√°lido)
      const cnpj = document.getElementById('cnpjDenuncia').value.trim();
      if (cnpj && !Validacao.validarCNPJ(cnpj)) {
        erros.push('CNPJ inv√°lido');
      }

      // Nome do estabelecimento
      const nome = document.getElementById('nomeEstabelecimento').value.trim();
      if (!Validacao.validarObrigatorio(nome)) {
        erros.push('Nome do estabelecimento √© obrigat√≥rio');
      }

      // Endere√ßo
      const endereco = document.getElementById('enderecoEstabelecimento').value.trim();
      if (!Validacao.validarObrigatorio(endereco)) {
        erros.push('Endere√ßo √© obrigat√≥rio');
      }

      // Data
      const data = document.getElementById('dataDenuncia').value;
      if (!Validacao.validarData(data)) {
        erros.push('Data inv√°lida');
      }
      if (!Validacao.validarDataNaoFutura(data)) {
        erros.push('Data n√£o pode ser futura');
      }

      // Tipo
      const tipo = document.getElementById('tipoDenuncia').value;
      if (!tipo) {
        erros.push('Selecione o tipo de problema');
      }

      // Descri√ß√£o
      const descricao = document.getElementById('descricaoDenuncia').value.trim();
      if (!Validacao.validarComprimentoMinimo(descricao, 20)) {
        erros.push('Descri√ß√£o deve ter pelo menos 20 caracteres');
      }

      // Termos
      const concordo = document.getElementById('concordoTermos').checked;
      if (!concordo) {
        erros.push('Voc√™ deve concordar com os termos');
      }

      return {
        valido: erros.length === 0,
        erros: erros
      };
    }
  </script>
</body>
</html>
